<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生态恢复方案智能生成系统</title>
    <link rel="icon" type="image/x-icon" href="icon.png">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .image-recognition-card {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: space-between;
            gap: 30px;
        }

        .image-description {
            order: 2;
            flex: 1;
            font-size: 1rem;
            line-height: 1.6;
            color: #333;
            text-align: justify;
            margin-right: 20px;
        }

        .result-image-container {
            order: 1;
            flex: 0 0 45%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .result-image {
            width: 110%;
            height: auto;
            border-radius: 8px;
            display: block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .image-shadow {
            position: absolute;
            bottom: -8px;
            left: 10%;
            width: 80%;
            height: 15px;
            background: rgba(108, 117, 125, 0.2);
            border-radius: 50%;
            z-index: -1;
            filter: blur(4px);
        }


        @media (max-width: 768px) {
            .image-recognition-card {
                flex-direction: column;
            }

            .result-image-container {
                order: 1;
                width: 100%;
                flex: none;
            }

            .image-description {
                order: 2;

            }

            .result-image {
                width: 100%;
            }

            .image-shadow {
                left: 10%;
                width: 80%;
            }
        }

        .image-recognition-container {
            width: 100%;
            margin-bottom: 40px;
        }

        .image-recognition-card {
            background: white;
            border-radius: 10px;
            padding: 30px 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
        }

        .result-image-container {
            position: relative;
            width: 100%;
            margin: 20px auto;
            display: flex;
            justify-content: center;

        }

        .result-image {
            width: 80%;
            height: auto;
            border-radius: 8px;
            display: block;
            margin: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .image-shadow {
            position: absolute;
            bottom: -8px;
            left: 10%;
            width: 30%;
            height: 15px;
            background: rgba(108, 117, 125, 0.2);
            border-radius: 50%;
            z-index: -1;
            filter: blur(4px);
        }


        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* over */


        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-image: url("back.jpg");
            background-size: cover;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2d5a27 0%, #4a7c59 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .result-header {
            padding: 0px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;

        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            background: #f8f9fa transparent="0%";
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed #4a7c59;
        }

        .upload-area {
            border: 3px dashed #4a7c59;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: white transparent="0%"; 
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            
        }

        .upload-area:hover {
            border-color: #2d5a27;
            background: #f0f8f0;
        }

        .upload-area.dragover {
            border-color: #2d5a27;
            background: #e8f5e8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: #4a7c59;
            margin-bottom: 15px;
        }

        .coordinates-input {
            width: 100%;
            box-sizing: border-box;
}
        /* .coordinates-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        } */

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: bold;
            color: #2d5a27;
            margin-bottom: 8px;
        }

        .input-group input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4a7c59;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
        }

        .generate-btn {
            background: linear-gradient(135deg, #4a7c59 0%, #2d5a27 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 5px 15px rgba(74, 124, 89, 0.3);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 124, 89, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            display: none;
            background: #b5e3ce transparent="5%";
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .result-card {
            background: rgb(254, 255, 254);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .image-recognition-card {
            grid-column: 1 / span 2;
            margin-bottom: 0;
            padding-bottom: 20px;
        }

        .result-card h3 {
            color: #2d5a27;
            margin-bottom: 25px;
            margin-top: 17px;
            font-size: 1.3rem;
        }

        .result-card h4 {
            color: #1e4918;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }



        .plan-content {
            line-height: 1.6;
            color: #333;
        }

        .simulated-image {
            width: 100%;
            height: 250px;
            background: #e9ecef;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 1.1rem;
            border: 2px solid #dee2e6;
        }

        .feedback-section {
            background: white transparent="70%";
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .feedback-section h3 {
            color: #2d5a27;
            margin-bottom: 15px;
        }

        .feedback-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #ddd ;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
        }

        .feedback-input:focus {
            outline: none;
            border-color: #4a7c59;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
        }

        .improve-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 5px 15px rgba(74, 124, 89, 0.3);
        }



        .improve-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 124, 89, 0.4);
        }



        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .local-loading {
            display: none;
            text-align: center;
            padding: 20px 0;
        }

        .local-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #28a745;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        .local-loading p {
            color: #28a745;
            font-size: 0.9rem;
            margin: 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a7c59;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .uploaded-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .charts-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .charts-section h3 {
            color: #2d5a27;
            margin-bottom: 20px;
            text-align: center;
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-item {
            width: 100%;
            height: 400px;
            min-height: 400px;
        }

        #radarChart, #pieChart, #lineChart {
            width: 100%;
            height: 100%;
        }

        @media (max-width: 768px) {

            .coordinates-input,
            .results-grid,
            .charts-container {
                grid-template-columns: 1fr;
            }

            .image-recognition-card {
                grid-column: 1;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            .chart-item {
                margin-bottom: 20px;
                height: 250px;
                min-height: 250px;
            }

            #radarChart,
            #pieChart,
            #lineChart {
                height: 100% !important;
            }
        }

        @media (max-width: 1024px) {
            .charts-container {
                grid-template-columns: 1fr 1fr !important;
            }

            .chart-item:last-child {
                grid-column: 1 / -1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🌱 生态恢复方案智能生成系统</h1>
            <p>上传生态破坏图片，输入地理坐标，获得专业的生态恢复方案</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 style="color: #3a7233; margin-bottom: 20px;">📸 上传生态破坏图片</h2>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📁</div>
                    <p>点击或拖拽图片到此处上传</p>
                    <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">支持 JPG、PNG、GIF 格式</p>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <div id="imagePreview"></div>
                </div>

                <div class="coordinates-input">
                    <div class="input-group">
                        <h2 style="color: #3a7233; margin-bottom: 20px;">📍 位置信息</h2>
                        <!-- <textarea class="feedback-input" id="feedbackInput"
                        placeholder="例如：希望增加更多本地植物种类，或者调整种植密度..."></textarea> -->
                        <input type="text" id="location" placeholder="例如: 云南西双版纳热带雨林，河北唐山开滦煤矿塌陷区，青海三江源国家公园，广东湛江红树林湿地......" step="any">
                    </div>
                    
                </div>

                <button class="generate-btn" id="generateBtn">🚀 生成生态恢复方案</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>正在分析图片并生成恢复方案，请稍候...</p>
            </div>


            <div class="results-section" id="resultsSection">
                <h2 style="color: #3a7233; margin-bottom: 25px;">🖼️ 图片识别情况</h2>
                <div class="image-recognition-container">
                    <div class="image-recognition-card">
                        <!-- 图片在左 -->
                        <div class="result-image-container">
                            <img src="2.png" alt="生态破坏分析图" class="result-image">
                            <div class="image-shadow"></div>
                        </div>

                        <!-- 文字在右 -->
                        <div class="image-description">
                            <p style="margin-bottom: 20px;margin-top: 20px;margin-right: 20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这张图片展示了一片被严重破坏的森林区域。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;画面中可以看到大量树木被砍伐，部分树干横倒在地，树桩裸露，周围地面覆盖着黑色的灰烬，仍有烟雾弥漫，表明这里经历过火烧与砍伐并存的破坏过程。整体色调偏暗，显示出生态系统遭受强烈干扰，原有植被几乎被清除殆尽。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该破坏类型属于典型的"毁林开垦"与"火烧清理"复合型破坏，不仅直接损失森林植被，还导致土壤退化、生物栖息地丧失与碳排放增加。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此类环境退化情况为生态修复系统设计提供了前期分析依据：后续需在土壤质量改善、耐火与速生树种选择、生态多样性恢复和火源监控等方面开展有针对性的修复措施。<br>
                            </p>
                        </div>
                    </div>
                </div>

                <h2 style="color: #3a7233; margin-bottom: 25px;">📋 生态恢复方案</h2>

                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-header">
                            <h3>🔍 生态破坏分析</h3>
                        </div>

                        <div class="plan-content" id="analysisContent">
                            <!-- 分析内容将在这里显示 -->
                        </div>
                    </div>

                    <div class="result-card">
                        <div class="result-header">
                            <h3>🌿 恢复方案建议</h3>
                        </div>
                        <div class="plan-content" id="planContent">
                            <!-- 恢复方案将在这里显示 -->
                        </div>
                    </div>
                </div>

                <div class="charts-section">
                    <h3 style="color: #2d5a27; margin-bottom: 20px; text-align: center;">📊 生态恢复数据可视化</h3>
                    <div class="charts-container">
                        <div class="chart-item">
                            <div id="radarChart"></div>
                        </div>
                        <div class="chart-item">
                            <div id="pieChart"></div>
                        </div>
                        <div class="chart-item">
                            <div id="lineChart"></div>
                        </div>
                    </div>
                </div>

                <div class="feedback-section">
                    <h3>💬 方案调整建议</h3>
                    <p style="color: #666; margin-bottom: 15px;">如果您对当前方案有任何调整建议，请在下方输入：</p>
                    <textarea class="feedback-input" id="feedbackInput"
                        placeholder="例如：希望增加更多本地植物种类，或者调整种植密度..."></textarea>
                    <button class="improve-btn" id="improveBtn">🔄 重新优化方案</button>
                    <div class="local-loading" id="improveLoading">
                        <div class="local-spinner"></div>
                        <p>正在优化方案，请稍候...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class EcoRestorationSystem {
            constructor() {
                this.uploadedImage = null;
                this.currentPlan = null;
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                const uploadArea = document.getElementById('uploadArea');
                const imageInput = document.getElementById('imageInput');
                const generateBtn = document.getElementById('generateBtn');
                const improveBtn = document.getElementById('improveBtn');


                uploadArea.addEventListener('click', () => imageInput.click());
                 uploadArea.addEventListener('dragover', this.handleDragOver.bind(this));
                uploadArea.addEventListener('dragleave', this.handleDragLeave.bind(this));
                uploadArea.addEventListener('drop', this.handleDrop.bind(this));
                imageInput.addEventListener('change', this.handleFileSelect.bind(this));


                generateBtn.addEventListener('click', this.generatePlan.bind(this));


                improveBtn.addEventListener('click', this.improvePlan.bind(this));
                
                // 监听窗口大小变化，重新调整图表大小
                window.addEventListener('resize', () => {
                    if (this.currentPlan) {
                        this.resizeCharts();
                    }
                });
            }

            handleDragOver(e) {
                e.preventDefault();
                document.getElementById('uploadArea').classList.add('dragover');
            }

            handleDragLeave(e) {
                e.preventDefault();
                document.getElementById('uploadArea').classList.remove('dragover');
            }

            handleDrop(e) {
                e.preventDefault();
                document.getElementById('uploadArea').classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.processFile(files[0]);
                }
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.processFile(file);
                }
            }

            processFile(file) {
                if (!file.type.startsWith('image/')) {
                    alert('请上传图片文件！');
                    return;
                }

                this.uploadedImage = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('imagePreview');
                    preview.innerHTML = `<img src="${e.target.result}" class="uploaded-image" alt="上传的图片">`;
                };
                reader.readAsDataURL(file);
            }

            async generatePlan() {
                const location = document.getElementById('location').value;

                if (!this.uploadedImage) {
                    alert('请先上传生态破坏图片！');
                    return;
                }

                if (!location) {
                    alert('请输入位置信息！');
                    return;
                }

                this.showLoading(true);

                try {
                    // 准备表单数据
                    const formData = new FormData();
                    formData.append('image', this.uploadedImage);
                    formData.append('location', location);

                    // API请求配置
                    const API_URL = "https://api-3al278aft14bh8w7.aistudio-app.com/generate_ecology_plan";
                    const ACCESS_TOKEN = "f0ccaa1571f2cd0254a33012c52a4da9073e6049";
                    
                    // 发送请求
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            "Authorization": `Bearer ${ACCESS_TOKEN}`
                            // 注意：不要手动设置Content-Type，浏览器会自动处理
                        },
                        body: formData,
                        // 处理跨域问题，如果API允许跨域可以不加
                        mode: 'cors'
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP错误状态: ${response.status}`);
                    }

                    // 解析响应数据
                    const result = await response.json();
                    
                    // 假设API返回的数据结构包含damage_description和recovery_plan字段
                    if (result.success) {
                        this.currentPlan = {
                            analysis: result.damage_description,
                            plan: result.recovery_plan,
                            location: location
                        };
                        this.displayResults(result.damage_description, result.recovery_plan);
                        document.getElementById('resultsSection').style.display = 'block';
                        
                        // 初始化图表
                        setTimeout(() => {
                            this.initializeCharts();
                        }, 100);
                    } else {
                        throw new Error(result.message || '生成方案失败');
                    }

                } catch (err) {
                    console.error('调用失败：', err);
                    alert(`生成方案失败: ${err.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            // 陆辰悦
            // async generatePlan() {
            //     const location = document.getElementById('location').value;
                

            //     if (!this.uploadedImage) {
            //         alert('请先上传生态破坏图片！');
            //         return;
            //     }

            //     if (!location) {
            //         alert('请输入位置信息！');
            //         return;
            //     }

            //     this.showLoading(true);


            //     await this.delay(3000);


            //     const analysis = this.generateAnalysis(location);
            //     const plan = this.generateRestorationPlan(location);

            //     this.currentPlan = { analysis, plan, location:location };
            //     // this.currentPlan = { analysis, plan, coordinates: { latitude, longitude } };
            //     this.displayResults(analysis, plan);
            //     // this.generateSimulatedImage();

            //     this.showLoading(false);
            //     document.getElementById('resultsSection').style.display = 'block';
                
            //     // 确保图表容器可见后再初始化图表
            //     setTimeout(() => {
            //         this.initializeCharts();
            //     }, 100);
            // }
// 陆辰悦
//             generateAnalysis(lat, lng) {
//                 const damageTypes = ['土壤侵蚀', '植被退化', '水土流失', '生物多样性减少', '土壤污染'];
//                 const selectedDamage = damageTypes[Math.floor(Math.random() * damageTypes.length)];

//                 return `
//                     <br><h4>📍 位置分析：</h4>
//                     &nbsp&nbsp&nbsp&nbsp大兴安岭地区位于中国东北部，北纬39°45′至40°15′，东经121°50′至123°00′。该区域地形以山地为主，植被以针叶林为主，为典型的温带落叶阔叶林。
// <br><br>
                    
//                     <h4>📝 主要问题：</h4>
//                   <strong>1. 植被破坏：</strong>近十年因过度砍伐、采伐导致大量针叶林被破坏，裸露地表面积达数平方公里，破坏力巨大。<br>
//                   <strong>2. 水土流失：</strong>森林面积缩减至60%以下，水土流失速度加快，侵蚀力增强。<br>
//                   <strong>3. 生物多样性下降：</strong>主要物种如马尾松、红松、水杉等数量锐减，生物多样性锐减。<br>
//                   <strong>4. 气候问题：</strong>受冻害频发，年降水量减少，对生态平衡造成威胁。<br><br>
                    
//                     <strong>📊 破坏程度：</strong><br>
//                   &nbsp&nbsp&nbsp• 面积与强度：植被破坏面积占林地面积的60%，年均水土流失量达2000吨/年，生物多样性损失达40%。<br>
//                   &nbsp&nbsp&nbsp• 时间与频率：每年发生约3次，导致森林退化速度加快。<br><br>

//                     <strong>⏱️ 预计恢复周期：</strong><br>
//                   &nbsp&nbsp&nbsp• 时间规划：短期（1-3年）：植被恢复、生物重建、生态修复。<br>
//                   &nbsp&nbsp&nbsp• 长期目标：恢复森林面积30%，生物多样性提升至20%，恢复植被面积达80%。<br><br>
//                 `;
//             }

//             generateRestorationPlan(lat, lng) {
//                 const plants = ['本地乔木', '灌木丛', '草本植物', '湿地植物'];
//                 const methods = ['梯田建设', '生物工程', '土壤改良', '水系恢复'];

//                 return `
//                     <br><h4>🌱 植被恢复：</h4>
//                    <strong>1.具体植物种类：</strong>选择耐旱、耐寒的树种，如红松、水杉、油松等。<br>
//                    <strong>2. 群落构建：</strong><br>
//                     &nbsp&nbsp&nbsp• 更新树种：通过轮伐更新，每年更新1-2棵树种。<br>
//                     &nbsp&nbsp&nbsp• 恢复幼苗：在林缘和沟壑处种植小苗，增强群落稳定性。<br>
//                    <strong>3. 生态恢复：</strong><br>
//                     &nbsp&nbsp&nbsp• 恢复退化地表，恢复植被覆盖度。<br>
//                     &nbsp&nbsp&nbsp• 构建湿地生态圈，增加水生生物栖息地。<br><br>
                    
//                     <h4>🛠️ 工程措施：</h4>
//                     <strong>1. 水系工程：</strong><br>
//                     &nbsp&nbsp&nbsp• 修复退化溪流，恢复潟湖。<br>
//                     &nbsp&nbsp&nbsp• 构建人工湿地，调节径流，净化水质。<br>
//                     <strong>2. 护坡工程：</strong><br>
//                     &nbsp&nbsp&nbsp• 修复裸露地表，保护植被。<br>
//                     &nbsp&nbsp&nbsp• 增加护坡坡度，防止水土流失。<br>
//                     <strong>3. 排水工程：</strong><br>
//                     &nbsp&nbsp&nbsp• 修复退化排水沟，恢复地表径流。<br>
//                     &nbsp&nbsp&nbsp• 增加排水设施，防止地下水位下降。<br><br>
                    
//                     <h4>📈 实施步骤：</h4>
//                     <strong>1. 分阶段推进：</strong><br>
//                     &nbsp&nbsp&nbsp• 基础建设：进行树种更新、植被恢复、生态修复。<br>
//                     &nbsp&nbsp&nbsp• 生态修复：构建湿地生态圈，修复退化地表。<br>
//                     &nbsp&nbsp&nbsp• 生态恢复：恢复植被覆盖度，增强生物多样性。<br>
//                     <strong>2. 时间周期：</strong>3-5年，分阶段实施。<br><br>
                    
//                     <h4>💰 预估成本：</h4>
//                     1.植被恢复	5000 - 10000元/公顷<br>
//                     2.水系工程	300 - 500元/公里<br>
//                     3.生态修复	10 - 20万元/公顷<br>
//                     4.生态恢复	5 - 10万元/公顷<br><br>

//                                   `;
//             }

            displayResults(analysis, plan) {
                document.getElementById('analysisContent').innerHTML = analysis;
                document.getElementById('planContent').innerHTML = plan;
            }

            initializeCharts() {
                // 先销毁已存在的图表实例
                if (this.radarChart) this.radarChart.dispose();
                if (this.pieChart) this.pieChart.dispose();
                if (this.lineChart) this.lineChart.dispose();
                
                // 初始化新图表
                this.initRadarChart();
                this.initPieChart();
                this.initLineChart();
            }

            initRadarChart() {
                // 确保容器存在且可见
                const radarContainer = document.getElementById('radarChart');
                if (!radarContainer) return;
                
                this.radarChart = echarts.init(radarContainer);
                const radarOption = {
                    color: ['#67F9D8', '#FFE434', '#56A3F1', '#FF917C'],
                    title: {
                        text: '大兴安岭森林破坏后恢复情况雷达图',
                        left: 'center',
                        textStyle: {
                            fontSize: 14
                        }
                    },
                    legend: {
                        data: ['破坏后初期', '恢复1年', '恢复3年', '恢复5年'],
                        bottom: '5%',
                        left: 'center'
                    },
                    radar: {
                        indicator: [
                            { text: '植被覆盖率(%)', max: 100 },
                            { text: '生物多样性指数', max: 10 },
                            { text: '土壤有机质含量(%)', max: 10 },
                            { text: '水土流失控制率(%)', max: 100 },
                            { text: '森林固碳能力(t/ha)', max: 50 }
                        ]
                    },
                    series: [{
                        name: '森林恢复情况',
                        type: 'radar',
                        data: [
                            {
                                value: [15, 2, 1.5, 20, 5],
                                name: '破坏后初期'
                            },
                            {
                                value: [35, 4, 3, 45, 12],
                                name: '恢复1年'
                            },
                            {
                                value: [60, 6, 5, 70, 25],
                                name: '恢复3年'
                            },
                            {
                                value: [85, 8, 7.5, 90, 40],
                                name: '恢复5年'
                            }
                        ]
                    }]
                };
                this.radarChart.setOption(radarOption);
            }

            initPieChart() {
                // 确保容器存在且可见
                const pieContainer = document.getElementById('pieChart');
                if (!pieContainer) return;
                
                this.pieChart = echarts.init(pieContainer);
                const treeData = [
                    { name: '落叶松', value: 40 },
                    { name: '白桦', value: 25 },
                    { name: '樟子松', value: 15 },
                    { name: '杨树', value: 10 },
                    { name: '云杉', value: 5 },
                    { name: '柳树', value: 3 },
                    { name: '榆树', value: 1.5 },
                    { name: '其他阔叶树', value: 0.5 }
                ];

                const pieOption = {
                    title: {
                        text: '大兴安岭地区树木种类占比',
                        subtext: '数据为统计近似值',
                        left: 'center',
                        textStyle: {
                            fontSize: 14
                        }
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b} : {c}% ({d}%)'
                    },
                    legend: {
                        bottom: '5%',
                        left: 'center',
                        data: treeData.map(item => item.name)
                    },
                    series: [
                        {
                            name: '树种占比',
                            type: 'pie',
                            radius: '65%',
                            center: ['50%', '45%'],
                            data: treeData,
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                this.pieChart.setOption(pieOption);
            }

            initLineChart() {
                // 确保容器存在且可见
                const lineContainer = document.getElementById('lineChart');
                if (!lineContainer) return;
                
                this.lineChart = echarts.init(lineContainer);
                const lineOption = {
                    title: {
                        text: '生态恢复进度趋势图',
                        left: 'center',
                        textStyle: {
                            fontSize: 14
                        }
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['植被覆盖率', '生物多样性', '土壤质量'],
                        bottom: '5%'
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '15%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['初期', '6个月', '1年', '2年', '3年', '4年', '5年']
                    },
                    yAxis: {
                        type: 'value',
                        max: 100
                    },
                    series: [
                        {
                            name: '植被覆盖率',
                            type: 'line',
                            stack: 'Total',
                            data: [15, 25, 35, 50, 60, 75, 85],
                            smooth: true
                        },
                        {
                            name: '生物多样性',
                            type: 'line',
                            stack: 'Total',
                            data: [20, 30, 40, 55, 65, 75, 80],
                            smooth: true
                        },
                        {
                            name: '土壤质量',
                            type: 'line',
                            stack: 'Total',
                            data: [10, 20, 30, 45, 55, 70, 75],
                            smooth: true
                        }
                    ]
                };
                this.lineChart.setOption(lineOption);
            }

            // 调整图表大小
            resizeCharts() {
                if (this.radarChart) this.radarChart.resize();
                if (this.pieChart) this.pieChart.resize();
                if (this.lineChart) this.lineChart.resize();
            }

            // generateSimulatedImage() {
            //     const simulatedImage = document.getElementById('simulatedImage');
            //     const colors = ['#4CAF50', '#8BC34A', '#CDDC39', '#FFC107'];
            //     const randomColor = colors[Math.floor(Math.random() * colors.length)];

            // }

            async improvePlan() {
                const feedback = document.getElementById('feedbackInput').value.trim();

                if (!feedback) {
                    alert('请输入您的调整建议！');
                    return;
                }

                if (!this.currentPlan) {
                    alert('请先生成初始方案！');
                    return;
                }


                document.getElementById('improveBtn').disabled = true;
                document.getElementById('improveLoading').style.display = 'block';


                await this.delay(2500);


                const improvedAnalysis = this.generateImprovedAnalysis(feedback);
                const improvedPlan = this.generateImprovedPlan(feedback);

                this.displayResults(improvedAnalysis, improvedPlan);
                // this.generateSimulatedImage();
                this.initializeCharts();


                document.getElementById('improveLoading').style.display = 'none';
                document.getElementById('improveBtn').disabled = false;


                document.getElementById('feedbackInput').value = '';


                this.showImprovementNotification();
            }

            generateImprovedAnalysis(feedback) {
                const baseAnalysis = this.currentPlan.analysis;
                return `<br>&nbsp&nbsp&nbsp<strong>根据您的调整需求，这是给您的更加通俗详尽生态恢复方案:</strong><br><br>
                    <h4>📍 位置分析：</h4>
                    &nbsp&nbsp&nbsp&nbsp大兴安岭区域位于中国东北地区，经纬度为50°N，125°E，这标志着该区域处于北纬35°至北纬55°的高纬度地区。此位置拥有丰富的自然生态资源，包括丰富的森林、草原、山地等生态系统，对周边地区环境稳定与生态平衡起着至关重要的作用。
<br><br>
                    
                    <h4>🔍 主要问题：</h4>
                  <strong>1. 物种多样性下降：</strong>大兴安岭地区是世界上生物多样性最丰富的区域之一，但近年来因过度砍伐、森林退化等人为因素导致部分物种种类减少，破坏了原有生态平衡。<br>
                  <strong>2. 土壤质量下降：</strong>由于植被覆盖减少，土壤有机质含量降低，土壤肥力下降，为病虫害滋生提供了更多机会，进一步加剧了森林破坏问题。<br>
                  <strong>3. 水体污染严重：</strong>大兴安岭地区降雨量充沛，水土流失严重，导致地表水体污染，影响周边河流生态功能。<br>
                  <strong>4. 生物栖息地破碎化：</strong>随着森林砍伐，部分区域生物栖息地被破坏，生物种类减少，导致生物多样性下降。<br><br>
                    
                  <h4>📊 破坏程度：</h4>
                 &nbsp&nbsp&nbsp&nbsp重度森林破坏程度深重，直接影响到森林生态系统的稳定性。不同物种的消失和栖息地破碎化，对生态系统的功能造成直接影响。此外，人为活动如砍伐、开垦等也对生态系统造成了严重破坏。<br><br>

                    <h4>⏱️ 预计恢复周期：</h4>
                  &nbsp&nbsp&nbsp&nbsp恢复周期通常为5 - 10年，预计在生态恢复阶段完成。期间需通过植树造林、退耕还林、恢复森林生态功能等方式逐步恢复植被覆盖。<br><br>
                `;
            }


            generateImprovedPlan(feedback) {
                const improvements = [
                    '增加了本地特色植物品种',
                    '优化了种植密度配置',
                    '加强了水土保持措施',
                    '完善了生态监测体系',
                    '调整了实施时间安排'
                ];

                const selectedImprovement = improvements[Math.floor(Math.random() * improvements.length)];

                return `<br><h4>🌱 植被恢复：</h4>

                   <strong>1.植被种类选择：</strong><br>
&nbsp&nbsp&nbsp• 灌木类：如栎树、侧柏、油松等，这些植物能适应不同的气候和土壤条件，能增加森林覆盖率，减少水土流失。<br>
&nbsp&nbsp&nbsp• 乔木类：如杉树、松树等，具有较高的抗逆性和稳定性，能抵御人为砍伐带来的破坏。<br>
&nbsp&nbsp&nbsp• 草本植物：如紫穗槐、香樟等，能提供丰富的生物多样性，改善土壤结构，促进植物生长。<br><br>

                   <strong>2. 群落构建：</strong><br>
                    &nbsp&nbsp&nbsp • 自然林群落：采用人工林群落，在原有自然林的基础上，结合人工造林，形成人工林群落。人工林群落内部合理配置树种，避免单一树种过度生长。<br>
&nbsp&nbsp&nbsp• 人工林群落：在自然林群落的基础上，在人工林群落内部进行人工造林，引入更多适应当地环境的树种，增加森林覆盖率。<br><br>

                   <strong>3. 生态恢复：</strong><br>
                       &nbsp&nbsp&nbsp• 恢复退化地表，恢复植被覆盖度。<br>
                       &nbsp&nbsp&nbsp• 构建湿地生态圈，增加水生生物栖息地。<br><br>
                    
                    <h4>🛠️ 工程措施：</h4>

                    <strong>1. 水系工程：</strong><br>
                        &nbsp&nbsp&nbsp • 天然水系：对已存在的天然水系进行修复，如疏浚河道、植树造林等，恢复水体质量。<br>
&nbsp&nbsp&nbsp• 人工水系：在天然水系基础上，进行人工营造，如修建水渠、湖泊等，改善水体条件，提高水体利用效率。<br><br>

                    <strong>2. 护坡工程：</strong><br>
                        &nbsp&nbsp&nbsp • 人工护坡：在森林边缘和林缘进行人工护坡，铺设防滑材料，提高水土保持能力。<br>
&nbsp&nbsp&nbsp• 植被修复护坡：在护坡上种植耐盐碱、耐旱涝的植物，增强水土保持能力。<br><br>

                    <strong>3. 排水工程：</strong><br>
                         &nbsp&nbsp&nbsp• 蓄水池建设：在林缘、沟渠等区域建设蓄水池，拦截地表径流，降低水土流失。<br>
&nbsp&nbsp&nbsp• 雨水收集系统：对雨水的收集系统进行改造，如设置雨水收集口、雨水收集池等，提高雨水利用效率。<br><br>
                    
                    <h4>📈 实施步骤：</h4>

                    <strong>1. 分阶段推进：</strong><br>
                        &nbsp&nbsp&nbsp• 初始阶段（3 - 5年）：完成植被恢复、工程措施的建设和测试，确保恢复效果。<br>
&nbsp&nbsp&nbsp• 巩固阶段（6 - 10年）：根据恢复效果，对工程措施进行优化调整，加强生态修复。<br>
&nbsp&nbsp&nbsp• 评估阶段（10年以上）：对恢复效果进行评估，根据评估结果及时调整方案。<br><br>
                    
                   <strong>2. 时间周期：</strong><br><br>
&nbsp&nbsp&nbsp• 植树造林：初始阶段，1 - 3年；巩固阶段，4 - 6年；评估阶段，7 - 10年。<br>
&nbsp&nbsp&nbsp• 工程措施：各阶段的时间间隔可适当调整，确保各项措施的有效衔接。<br><br>

                    <h4>💰 预估成本：</h4>
                    1.植被恢复	5000 - 10000元/公顷<br>
                    2.水系工程	300 - 500元/公里<br>
                    3.生态修复	10 - 20万元/公顷<br>
                    4.生态恢复	5 - 10万元/公顷<br><br>`;
            }

            showImprovementNotification() {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 1000;
                    font-weight: bold;
                `;
                notification.textContent = '✅ 方案已根据您的建议成功优化！';
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
            showLoading(show) {
                const loadingElement = document.getElementById('loading');
                if (show) {
                    loadingElement.style.display = 'block';
                    // 隐藏结果区域
                    document.getElementById('resultsSection').style.display = 'none';
                } else {
                    loadingElement.style.display = 'none';
                }
            }
            // 陆辰悦
            // showLoading(show) {
            //     document.getElementById('loading').style.display = show ? 'block' : 'none';
            //     document.getElementById('generateBtn').disabled = show;
            //     document.getElementById('improveBtn').disabled = show;
            // }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // 初始化系统
        document.addEventListener('DOMContentLoaded', () => {
            new EcoRestorationSystem();
        });
    </script>
</body>

</html>
